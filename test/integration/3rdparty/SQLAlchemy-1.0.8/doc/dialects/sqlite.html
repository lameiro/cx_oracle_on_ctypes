<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        
        <title>
            
    
    SQLite
 &mdash;
    SQLAlchemy 1.0 Documentation

        </title>

        
            <!-- begin iterate through SQLA + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
            <!-- end iterate through SQLA + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.0 Documentation" href="../index.html" />
        <link rel="up" title="Dialects" href="index.html" />
        <link rel="next" title="Sybase" href="sybase.html" />
        <link rel="prev" title="PostgreSQL" href="postgresql.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.0.8</span> | Release Date: July 22, 2015
    </div>

    <h1>SQLAlchemy 1.0 Documentation</h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 1.0 Documentation</a></h3>

            <p id="sidebar-topnav">
                <a href="../contents.html">Contents</a> |
                <a href="../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <input type="text" name="q" size="12" /> <input type="submit" value="Search" />
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        
        <h3>
            <a href="index.html" title="Dialects">Dialects</a>
        </h3>

        <ul>
<li><span class="link-container first"><a class="reference external" href="firebird.html">Firebird</a></span></li>
<li><span class="link-container first"><a class="reference external" href="mssql.html">Microsoft SQL Server</a></span></li>
<li><span class="link-container first"><a class="reference external" href="mysql.html">MySQL</a></span></li>
<li><span class="link-container first"><a class="reference external" href="oracle.html">Oracle</a></span></li>
<li><span class="link-container first"><a class="reference external" href="postgresql.html">PostgreSQL</a></span></li>
<li class="selected"><span class="link-container first"><strong>SQLite</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#dialect-sqlite">Support for the SQLite database.</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#date-and-time-types">Date and Time Types</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#ensuring-text-affinity">Ensuring Text affinity</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="#sqlite-auto-incrementing-behavior">SQLite Auto Incrementing Behavior</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#using-the-autoincrement-keyword">Using the AUTOINCREMENT Keyword</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer">Allowing autoincrement behavior SQLAlchemy types other than Integer/INTEGER</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="#database-locking-behavior-concurrency">Database Locking Behavior / Concurrency</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#transaction-isolation-level">Transaction Isolation Level</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#savepoint-support">SAVEPOINT Support</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#transactional-ddl">Transactional DDL</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#foreign-key-support">Foreign Key Support</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#type-reflection">Type Reflection</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#partial-indexes">Partial Indexes</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#dotted-column-names">Dotted Column Names</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#sqlite-data-types">SQLite Data Types</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlite">Pysqlite</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#dialect-sqlite-pysqlite-url">DBAPI</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#dialect-sqlite-pysqlite-connect">Connecting</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#driver">Driver</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#connect-strings">Connect Strings</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#compatibility-with-sqlite3-native-date-and-datetime-types">Compatibility with sqlite3 &#8220;native&#8221; date and datetime types</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#threading-pooling-behavior">Threading/Pooling Behavior</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#using-a-memory-database-in-multiple-threads">Using a Memory Database in Multiple Threads</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#using-temporary-tables-with-sqlite">Using Temporary Tables with SQLite</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="#unicode">Unicode</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#serializable-isolation-savepoints-transactional-ddl">Serializable isolation / Savepoints / Transactional DDL</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher">Pysqlcipher</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#dialect-sqlite-pysqlcipher-url">DBAPI</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#dialect-sqlite-pysqlcipher-connect">Connecting</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#id3">Driver</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#id5">Connect Strings</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#pooling-behavior">Pooling Behavior</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="sybase.html">Sybase</a></span></li>
</ul>



        </div>

    </div>

    

    <div id="docs-body" class="withsidebar" >
        
<div class="section" id="module-sqlalchemy.dialects.sqlite.base">
<span id="sqlite"></span><span id="sqlite-toplevel"></span><h1>SQLite<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.base" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dialect-sqlite">
<p>Support for the SQLite database.</p>
<h2>DBAPI Support<a class="headerlink" href="#dialect-sqlite" title="Permalink to this headline">¶</a></h2>
<p>The following dialect/DBAPI options are available.  Please refer to individual DBAPI sections for connect information.<ul class="simple">
<li><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlite">pysqlite</a></li>
<li><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher">pysqlcipher</a></li>
</ul>
</p>
</div>
<div class="section" id="date-and-time-types">
<span id="sqlite-datetime"></span><h2>Date and Time Types<a class="headerlink" href="#date-and-time-types" title="Permalink to this headline">¶</a></h2>
<p>SQLite does not have built-in DATE, TIME, or DATETIME types, and pysqlite does
not provide out of the box functionality for translating values between Python
<cite>datetime</cite> objects and a SQLite-supported format. SQLAlchemy&#8217;s own
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal"><span class="pre">DateTime</span></code></a> and related types provide date formatting
and parsing functionality when SQlite is used. The implementation classes are
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME" title="sqlalchemy.dialects.sqlite.DATETIME"><code class="xref py py-class docutils literal"><span class="pre">DATETIME</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATE" title="sqlalchemy.dialects.sqlite.DATE"><code class="xref py py-class docutils literal"><span class="pre">DATE</span></code></a> and <a class="reference internal" href="#sqlalchemy.dialects.sqlite.TIME" title="sqlalchemy.dialects.sqlite.TIME"><code class="xref py py-class docutils literal"><span class="pre">TIME</span></code></a>.
These types represent dates and times as ISO formatted strings, which also
nicely support ordering. There&#8217;s no reliance on typical &#8220;libc&#8221; internals for
these functions so historical dates are fully supported.</p>
<div class="section" id="ensuring-text-affinity">
<h3>Ensuring Text affinity<a class="headerlink" href="#ensuring-text-affinity" title="Permalink to this headline">¶</a></h3>
<p>The DDL rendered for these types is the standard <code class="docutils literal"><span class="pre">DATE</span></code>, <code class="docutils literal"><span class="pre">TIME</span></code>
and <code class="docutils literal"><span class="pre">DATETIME</span></code> indicators.    However, custom storage formats can also be
applied to these types.   When the
storage format is detected as containing no alpha characters, the DDL for
these types is rendered as <code class="docutils literal"><span class="pre">DATE_CHAR</span></code>, <code class="docutils literal"><span class="pre">TIME_CHAR</span></code>, and <code class="docutils literal"><span class="pre">DATETIME_CHAR</span></code>,
so that the column continues to have textual affinity.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://www.sqlite.org/datatype3.html#affinity">Type Affinity</a> - in the SQLite documentation</p>
</div>
</div>
</div>
<div class="section" id="sqlite-auto-incrementing-behavior">
<span id="sqlite-autoincrement"></span><h2>SQLite Auto Incrementing Behavior<a class="headerlink" href="#sqlite-auto-incrementing-behavior" title="Permalink to this headline">¶</a></h2>
<p>Background on SQLite&#8217;s autoincrement is at: <a class="reference external" href="http://sqlite.org/autoinc.html">http://sqlite.org/autoinc.html</a></p>
<p>Key concepts:</p>
<ul class="simple">
<li>SQLite has an implicit &#8220;auto increment&#8221; feature that takes place for any
non-composite primary-key column that is specifically created using
&#8220;INTEGER PRIMARY KEY&#8221; for the type + primary key.</li>
<li>SQLite also has an explicit &#8220;AUTOINCREMENT&#8221; keyword, that is <strong>not</strong>
equivalent to the implicit autoincrement feature; this keyword is not
recommended for general use.  SQLAlchemy does not render this keyword
unless a special SQLite-specific directive is used (see below).  However,
it still requires that the column&#8217;s type is named &#8220;INTEGER&#8221;.</li>
</ul>
<div class="section" id="using-the-autoincrement-keyword">
<h3>Using the AUTOINCREMENT Keyword<a class="headerlink" href="#using-the-autoincrement-keyword" title="Permalink to this headline">¶</a></h3>
<p>To specifically render the AUTOINCREMENT keyword on the primary key column
when rendering DDL, add the flag <code class="docutils literal"><span class="pre">sqlite_autoincrement=True</span></code> to the Table
construct:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Table</span><span class="p">(</span><span class="s">&#39;sometable&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">sqlite_autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer">
<h3>Allowing autoincrement behavior SQLAlchemy types other than Integer/INTEGER<a class="headerlink" href="#allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer" title="Permalink to this headline">¶</a></h3>
<p>SQLite&#8217;s typing model is based on naming conventions.  Among
other things, this means that any type name which contains the
substring <code class="docutils literal"><span class="pre">&quot;INT&quot;</span></code> will be determined to be of &#8220;integer affinity&#8221;.  A
type named <code class="docutils literal"><span class="pre">&quot;BIGINT&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;SPECIAL_INT&quot;</span></code> or even <code class="docutils literal"><span class="pre">&quot;XYZINTQPR&quot;</span></code>, will be considered by
SQLite to be of &#8220;integer&#8221; affinity.  However, <strong>the SQLite
autoincrement feature, whether implicitly or explicitly enabled,
requires that the name of the column&#8217;s type
is exactly the string &#8220;INTEGER&#8221;</strong>.  Therefore, if an
application uses a type like <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal"><span class="pre">BigInteger</span></code></a> for a primary key, on
SQLite this type will need to be rendered as the name <code class="docutils literal"><span class="pre">&quot;INTEGER&quot;</span></code> when
emitting the initial <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> statement in order for the autoincrement
behavior to be available.</p>
<p>One approach to achieve this is to use <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal"><span class="pre">Integer</span></code></a> on SQLite
only using <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.with_variant()</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">BigInteger</span><span class="p">()</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="s">&quot;sqlite&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Another is to use a subclass of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal"><span class="pre">BigInteger</span></code></a> that overrides its DDL name
to be <code class="docutils literal"><span class="pre">INTEGER</span></code> when compiled against SQLite:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">BigInteger</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.compiler</span> <span class="kn">import</span> <span class="n">compiles</span>

<span class="k">class</span> <span class="nc">SLBigInteger</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">,</span> <span class="s">&#39;sqlite&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;INTEGER&quot;</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">visit_BIGINT</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">SLBigInteger</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.with_variant()</span></code></a></p>
<p><a class="reference internal" href="../core/compiler.html"><span>Custom SQL Constructs and Compilation Extension</span></a></p>
<p class="last"><a class="reference external" href="http://sqlite.org/datatype3.html">Datatypes In SQLite Version 3</a></p>
</div>
</div>
</div>
<div class="section" id="database-locking-behavior-concurrency">
<span id="sqlite-concurrency"></span><h2>Database Locking Behavior / Concurrency<a class="headerlink" href="#database-locking-behavior-concurrency" title="Permalink to this headline">¶</a></h2>
<p>SQLite is not designed for a high level of write concurrency. The database
itself, being a file, is locked completely during write operations within
transactions, meaning exactly one &#8220;connection&#8221; (in reality a file handle)
has exclusive access to the database during this period - all other
&#8220;connections&#8221; will be blocked during this time.</p>
<p>The Python DBAPI specification also calls for a connection model that is
always in a transaction; there is no <code class="docutils literal"><span class="pre">connection.begin()</span></code> method,
only <code class="docutils literal"><span class="pre">connection.commit()</span></code> and <code class="docutils literal"><span class="pre">connection.rollback()</span></code>, upon which a
new transaction is to be begun immediately.  This may seem to imply
that the SQLite driver would in theory allow only a single filehandle on a
particular database file at any time; however, there are several
factors both within SQlite itself as well as within the pysqlite driver
which loosen this restriction significantly.</p>
<p>However, no matter what locking modes are used, SQLite will still always
lock the database file once a transaction is started and DML (e.g. INSERT,
UPDATE, DELETE) has at least been emitted, and this will block
other transactions at least at the point that they also attempt to emit DML.
By default, the length of time on this block is very short before it times out
with an error.</p>
<p>This behavior becomes more critical when used in conjunction with the
SQLAlchemy ORM.  SQLAlchemy&#8217;s <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> object by default runs
within a transaction, and with its autoflush model, may emit DML preceding
any SELECT statement.   This may lead to a SQLite database that locks
more quickly than is expected.   The locking mode of SQLite and the pysqlite
driver can be manipulated to some degree, however it should be noted that
achieving a high degree of write-concurrency with SQLite is a losing battle.</p>
<p>For more information on SQLite&#8217;s lack of write concurrency by design, please
see
<a class="reference external" href="http://www.sqlite.org/whentouse.html">Situations Where Another RDBMS May Work Better - High Concurrency</a> near the bottom of the page.</p>
<p>The following subsections introduce areas that are impacted by SQLite&#8217;s
file-based architecture and additionally will usually require workarounds to
work when using the pysqlite driver.</p>
</div>
<div class="section" id="transaction-isolation-level">
<span id="sqlite-isolation-level"></span><h2>Transaction Isolation Level<a class="headerlink" href="#transaction-isolation-level" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports &#8220;transaction isolation&#8221; in a non-standard way, along two
axes.  One is that of the <a class="reference external" href="http://www.sqlite.org/pragma.html#pragma_read_uncommitted">PRAGMA read_uncommitted</a>
instruction.   This setting can essentially switch SQLite between its
default mode of <code class="docutils literal"><span class="pre">SERIALIZABLE</span></code> isolation, and a &#8220;dirty read&#8221; isolation
mode normally referred to as <code class="docutils literal"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code>.</p>
<p>SQLAlchemy ties into this PRAGMA statement using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.isolation_level</span></code></a> parameter of <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal"><span class="pre">create_engine()</span></code></a>.
Valid values for this parameter when used with SQLite are <code class="docutils literal"><span class="pre">&quot;SERIALIZABLE&quot;</span></code>
and <code class="docutils literal"><span class="pre">&quot;READ</span> <span class="pre">UNCOMMITTED&quot;</span></code> corresponding to a value of 0 and 1, respectively.
SQLite defaults to <code class="docutils literal"><span class="pre">SERIALIZABLE</span></code>, however its behavior is impacted by
the pysqlite driver&#8217;s default behavior.</p>
<p>The other axis along which SQLite&#8217;s transactional locking is impacted is
via the nature of the <code class="docutils literal"><span class="pre">BEGIN</span></code> statement used.   The three varieties
are &#8220;deferred&#8221;, &#8220;immediate&#8221;, and &#8220;exclusive&#8221;, as described at
<a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>.   A straight
<code class="docutils literal"><span class="pre">BEGIN</span></code> statement uses the &#8220;deferred&#8221; mode, where the the database file is
not locked until the first read or write operation, and read access remains
open to other transactions until the first write operation.  But again,
it is critical to note that the pysqlite driver interferes with this behavior
by <em>not even emitting BEGIN</em> until the first write operation.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">SQLite&#8217;s transactional scope is impacted by unresolved
issues in the pysqlite driver, which defers BEGIN statements to a greater
degree than is often feasible. See the section <a class="reference internal" href="#pysqlite-serializable"><span>Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</div>
<div class="section" id="savepoint-support">
<h2>SAVEPOINT Support<a class="headerlink" href="#savepoint-support" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports SAVEPOINTs, which only function once a transaction is
begun.   SQLAlchemy&#8217;s SAVEPOINT support is available using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal"><span class="pre">Connection.begin_nested()</span></code></a> method at the Core level, and
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.begin_nested" title="sqlalchemy.orm.session.Session.begin_nested"><code class="xref py py-meth docutils literal"><span class="pre">Session.begin_nested()</span></code></a> at the ORM level.   However, SAVEPOINTs
won&#8217;t work at all with pysqlite unless workarounds are taken.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">SQLite&#8217;s SAVEPOINT feature is impacted by unresolved
issues in the pysqlite driver, which defers BEGIN statements to a greater
degree than is often feasible. See the section <a class="reference internal" href="#pysqlite-serializable"><span>Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</div>
<div class="section" id="transactional-ddl">
<h2>Transactional DDL<a class="headerlink" href="#transactional-ddl" title="Permalink to this headline">¶</a></h2>
<p>The SQLite database supports transactional <a class="reference internal" href="../glossary.html#term-ddl"><span class="xref std std-term">DDL</span></a> as well.
In this case, the pysqlite driver is not only failing to start transactions,
it also is ending any existing transction when DDL is detected, so again,
workarounds are required.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">SQLite&#8217;s transactional DDL is impacted by unresolved issues
in the pysqlite driver, which fails to emit BEGIN and additionally
forces a COMMIT to cancel any transaction when DDL is encountered.
See the section <a class="reference internal" href="#pysqlite-serializable"><span>Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</div>
<div class="section" id="foreign-key-support">
<span id="sqlite-foreign-keys"></span><h2>Foreign Key Support<a class="headerlink" href="#foreign-key-support" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports FOREIGN KEY syntax when emitting CREATE statements for tables,
however by default these constraints have no effect on the operation of the
table.</p>
<p>Constraint checking on SQLite has three prerequisites:</p>
<ul class="simple">
<li>At least version 3.6.19 of SQLite must be in use</li>
<li>The SQLite library must be compiled <em>without</em> the SQLITE_OMIT_FOREIGN_KEY
or SQLITE_OMIT_TRIGGER symbols enabled.</li>
<li>The <code class="docutils literal"><span class="pre">PRAGMA</span> <span class="pre">foreign_keys</span> <span class="pre">=</span> <span class="pre">ON</span></code> statement must be emitted on all
connections before use.</li>
</ul>
<p>SQLAlchemy allows for the <code class="docutils literal"><span class="pre">PRAGMA</span></code> statement to be emitted automatically for
new connections through the usage of events:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="kn">import</span> <span class="n">Engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">Engine</span><span class="p">,</span> <span class="s">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_sqlite_pragma</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;PRAGMA foreign_keys=ON&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When SQLite foreign keys are enabled, it is <strong>not possible</strong>
to emit CREATE or DROP statements for tables that contain
mutually-dependent foreign key constraints;
to emit the DDL for these tables requires that ALTER TABLE be used to
create or drop these constraints separately, for which SQLite has
no support.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p><a class="reference external" href="http://www.sqlite.org/foreignkeys.html">SQLite Foreign Key Support</a>
- on the SQLite web site.</p>
<p><a class="reference internal" href="../core/event.html"><span>Events</span></a> - SQLAlchemy event API.</p>
<dl class="last docutils">
<dt><a class="reference internal" href="../core/constraints.html#use-alter"><span>Creating/Dropping Foreign Key Constraints via ALTER</span></a> - more information on SQLAlchemy&#8217;s facilities for handling</dt>
<dd>mutually-dependent foreign key constraints.</dd>
</dl>
</div>
</div>
<div class="section" id="type-reflection">
<span id="sqlite-type-reflection"></span><h2>Type Reflection<a class="headerlink" href="#type-reflection" title="Permalink to this headline">¶</a></h2>
<p>SQLite types are unlike those of most other database backends, in that
the string name of the type usually does not correspond to a &#8220;type&#8221; in a
one-to-one fashion.  Instead, SQLite links per-column typing behavior
to one of five so-called &#8220;type affinities&#8221; based on a string matching
pattern for the type.</p>
<p>SQLAlchemy&#8217;s reflection process, when inspecting types, uses a simple
lookup table to link the keywords returned to provided SQLAlchemy types.
This lookup table is present within the SQLite dialect as it is for all
other dialects.  However, the SQLite dialect has a different &#8220;fallback&#8221;
routine for when a particular type name is not located in the lookup map;
it instead implements the SQLite &#8220;type affinity&#8221; scheme located at
<a class="reference external" href="http://www.sqlite.org/datatype3.html">http://www.sqlite.org/datatype3.html</a> section 2.1.</p>
<p>The provided typemap will make direct associations from an exact string
name match for the following types:</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BIGINT" title="sqlalchemy.types.BIGINT"><code class="xref py py-class docutils literal"><span class="pre">BIGINT</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BLOB" title="sqlalchemy.types.BLOB"><code class="xref py py-class docutils literal"><span class="pre">BLOB</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal"><span class="pre">BOOLEAN</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal"><span class="pre">BOOLEAN</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.CHAR" title="sqlalchemy.types.CHAR"><code class="xref py py-class docutils literal"><span class="pre">CHAR</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DATE" title="sqlalchemy.types.DATE"><code class="xref py py-class docutils literal"><span class="pre">DATE</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DATETIME" title="sqlalchemy.types.DATETIME"><code class="xref py py-class docutils literal"><span class="pre">DATETIME</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal"><span class="pre">FLOAT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DECIMAL" title="sqlalchemy.types.DECIMAL"><code class="xref py py-class docutils literal"><span class="pre">DECIMAL</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal"><span class="pre">FLOAT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal"><span class="pre">INTEGER</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal"><span class="pre">INTEGER</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal"><span class="pre">NUMERIC</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal"><span class="pre">REAL</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.SMALLINT" title="sqlalchemy.types.SMALLINT"><code class="xref py py-class docutils literal"><span class="pre">SMALLINT</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal"><span class="pre">TEXT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIME" title="sqlalchemy.types.TIME"><code class="xref py py-class docutils literal"><span class="pre">TIME</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIMESTAMP" title="sqlalchemy.types.TIMESTAMP"><code class="xref py py-class docutils literal"><span class="pre">TIMESTAMP</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.VARCHAR" title="sqlalchemy.types.VARCHAR"><code class="xref py py-class docutils literal"><span class="pre">VARCHAR</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NVARCHAR" title="sqlalchemy.types.NVARCHAR"><code class="xref py py-class docutils literal"><span class="pre">NVARCHAR</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NCHAR" title="sqlalchemy.types.NCHAR"><code class="xref py py-class docutils literal"><span class="pre">NCHAR</span></code></a></p>
<p>When a type name does not match one of the above types, the &#8220;type affinity&#8221;
lookup is used instead:</p>
<ul class="simple">
<li><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal"><span class="pre">INTEGER</span></code></a> is returned if the type name includes the
string <code class="docutils literal"><span class="pre">INT</span></code></li>
<li><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal"><span class="pre">TEXT</span></code></a> is returned if the type name includes the
string <code class="docutils literal"><span class="pre">CHAR</span></code>, <code class="docutils literal"><span class="pre">CLOB</span></code> or <code class="docutils literal"><span class="pre">TEXT</span></code></li>
<li><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal"><span class="pre">NullType</span></code></a> is returned if the type name includes the
string <code class="docutils literal"><span class="pre">BLOB</span></code></li>
<li><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal"><span class="pre">REAL</span></code></a> is returned if the type name includes the string
<code class="docutils literal"><span class="pre">REAL</span></code>, <code class="docutils literal"><span class="pre">FLOA</span></code> or <code class="docutils literal"><span class="pre">DOUB</span></code>.</li>
<li>Otherwise, the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal"><span class="pre">NUMERIC</span></code></a> type is used.</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.9.3: </span>Support for SQLite type affinity rules when reflecting
columns.</p>
</div>
</div>
<div class="section" id="partial-indexes">
<span id="sqlite-partial-index"></span><h2>Partial Indexes<a class="headerlink" href="#partial-indexes" title="Permalink to this headline">¶</a></h2>
<p>A partial index, e.g. one which uses a WHERE clause, can be specified
with the DDL system using the argument <code class="docutils literal"><span class="pre">sqlite_where</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;testtbl&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="s">&#39;test_idx1&#39;</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">sqlite_where</span><span class="o">=</span><span class="n">and_</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">))</span></pre></div>
</div>
<p>The index will be rendered at create time as:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE INDEX test_idx1 ON testtbl (data)
WHERE data &gt; 5 AND data &lt; 10</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.9.9.</span></p>
</div>
</div>
<div class="section" id="dotted-column-names">
<h2>Dotted Column Names<a class="headerlink" href="#dotted-column-names" title="Permalink to this headline">¶</a></h2>
<p>Using table or column names that explicitly have periods in them is
<strong>not recommended</strong>.   While this is generally a bad idea for relational
databases in general, as the dot is a syntactically significant character,
the SQLite driver has a bug which requires that SQLAlchemy filter out these
dots in result sets.</p>
<p>The bug, entirely outside of SQLAlchemy, can be illustrated thusly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;:memory:&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">    select x.a, x.b from x where a=1</span>
<span class="s">    union</span>
<span class="s">    select x.a, x.b from x where a=2</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">],</span> \
    <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span></pre></div>
</div>
<p>The second assertion fails:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (most recent call last):
  File &quot;test.py&quot;, line 19, in &lt;module&gt;
    [c[0] for c in cursor.description]
AssertionError: [&#39;x.a&#39;, &#39;x.b&#39;]</pre></div>
</div>
<p>Where above, the driver incorrectly reports the names of the columns
including the name of the table, which is entirely inconsistent vs.
when the UNION is not present.</p>
<p>SQLAlchemy relies upon column names being predictable in how they match
to the original statement, so the SQLAlchemy dialect has no choice but
to filter these out:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">    select x.a, x.b from x where a=1</span>
<span class="s">    union</span>
<span class="s">    select x.a, x.b from x where a=2</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">]</span></pre></div>
</div>
<p>Note that above, even though SQLAlchemy filters out the dots, <em>both
names are still addressable</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s">&quot;x.a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s">&quot;x.b&quot;</span><span class="p">]</span>
<span class="go">1</span></pre></div>
</div>
<p>Therefore, the workaround applied by SQLAlchemy only impacts
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ResultProxy.keys" title="sqlalchemy.engine.ResultProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.keys()</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.RowProxy.keys" title="sqlalchemy.engine.RowProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">RowProxy.keys()</span></code></a> in the public API.
In the very specific case where
an application is forced to use column names that contain dots, and the
functionality of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ResultProxy.keys" title="sqlalchemy.engine.ResultProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.keys()</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.RowProxy.keys" title="sqlalchemy.engine.RowProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">RowProxy.keys()</span></code></a>
is required to return these dotted names unmodified, the <code class="docutils literal"><span class="pre">sqlite_raw_colnames</span></code>
execution option may be provided, either on a per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a> basis:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">sqlite_raw_colnames</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">    select x.a, x.b from x where a=1</span>
<span class="s">    union</span>
<span class="s">    select x.a, x.b from x where a=2</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s">&quot;x.a&quot;</span><span class="p">,</span> <span class="s">&quot;x.b&quot;</span><span class="p">]</span></pre></div>
</div>
<p>or on a per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a> basis:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;sqlite_raw_colnames&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span></pre></div>
</div>
<p>When using the per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a> execution option, note that
<strong>Core and ORM queries that use UNION may not function properly</strong>.</p>
</div>
<div class="section" id="sqlite-data-types">
<h2>SQLite Data Types<a class="headerlink" href="#sqlite-data-types" title="Permalink to this headline">¶</a></h2>
<p>As with all SQLAlchemy dialects, all UPPERCASE types that are known to be
valid with SQLite are importable from the top level dialect, whether
they originate from <a class="reference internal" href="../core/type_basics.html#module-sqlalchemy.types" title="sqlalchemy.types"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.types</span></code></a> or from the local dialect:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> \
            <span class="n">BLOB</span><span class="p">,</span> <span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">CHAR</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> <span class="n">DATETIME</span><span class="p">,</span> <span class="n">DECIMAL</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">,</span> \
            <span class="n">INTEGER</span><span class="p">,</span> <span class="n">NUMERIC</span><span class="p">,</span> <span class="n">SMALLINT</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> \
            <span class="n">VARCHAR</span></pre></div>
</div>
<span class="target" id="module-sqlalchemy.dialects.sqlite"></span><dl class="class">
<dt id="sqlalchemy.dialects.sqlite.DATETIME">
<em class="property">class </em><code class="descclassname">sqlalchemy.dialects.sqlite.</code><code class="descname">DATETIME</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATETIME" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.DateTime</span></code></a></p>
<p>Represent a Python datetime object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;</span><span class="si">%(year)04d</span><span class="s">-</span><span class="si">%(month)02d</span><span class="s">-</span><span class="si">%(day)02d</span><span class="s"> </span><span class="si">%(hour)02d</span><span class="s">:</span><span class="si">%(min)02d</span><span class="s">:</span><span class="si">%(second)02d</span><span class="s">.</span><span class="si">%(microsecond)06d</span><span class="s">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>2011-03-15 12:05:57.10558</pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal"><span class="pre">storage_format</span></code> and <code class="docutils literal"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATETIME</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">DATETIME</span><span class="p">(</span>
    <span class="n">storage_format</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%(year)04d</span><span class="s">/</span><span class="si">%(month)02d</span><span class="s">/</span><span class="si">%(day)02d</span><span class="s"> </span><span class="si">%(hour)02d</span><span class="s">:</span><span class="si">%(min)02d</span><span class="s">:</span><span class="si">%(second)02d</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="n">regexp</span><span class="o">=</span><span class="s">r&quot;(\d+)/(\d+)/(\d+) (\d+)-(\d+)-(\d+)&quot;</span>
<span class="p">)</span></pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.storage_format">¶</a> &#8211; format string which will be applied to the dict
with keys year, month, day, hour, minute, second, and microsecond.</li>
<li><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.regexp">¶</a> &#8211; regular expression which will be applied to incoming result
rows. If the regexp contains named groups, the resulting match dict is
applied to the Python datetime() constructor as keyword arguments.
Otherwise, if positional groups are used, the datetime() constructor
is called with positional arguments via
<code class="docutils literal"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="sqlalchemy.dialects.sqlite.DATE">
<em class="property">class </em><code class="descclassname">sqlalchemy.dialects.sqlite.</code><code class="descname">DATE</code><span class="sig-paren">(</span><em>storage_format=None</em>, <em>regexp=None</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATE" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Date" title="sqlalchemy.types.Date"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.Date</span></code></a></p>
<p>Represent a Python date object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;</span><span class="si">%(year)04d</span><span class="s">-</span><span class="si">%(month)02d</span><span class="s">-</span><span class="si">%(day)02d</span><span class="s">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">2011</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span></pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal"><span class="pre">storage_format</span></code> and <code class="docutils literal"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATE</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">DATE</span><span class="p">(</span>
        <span class="n">storage_format</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%(month)02d</span><span class="s">/</span><span class="si">%(day)02d</span><span class="s">/</span><span class="si">%(year)04d</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;(?P&lt;month&gt;\d+)/(?P&lt;day&gt;\d+)/(?P&lt;year&gt;\d+)&quot;</span><span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.storage_format">¶</a> &#8211; format string which will be applied to the
dict with keys year, month, and day.</li>
<li><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.regexp">¶</a> &#8211; regular expression which will be applied to
incoming result rows. If the regexp contains named groups, the
resulting match dict is applied to the Python date() constructor
as keyword arguments. Otherwise, if positional groups are used, the
date() constructor is called with positional arguments via
<code class="docutils literal"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="sqlalchemy.dialects.sqlite.TIME">
<em class="property">class </em><code class="descclassname">sqlalchemy.dialects.sqlite.</code><code class="descname">TIME</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.TIME" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Time" title="sqlalchemy.types.Time"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.Time</span></code></a></p>
<p>Represent a Python time object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;</span><span class="si">%(hour)02d</span><span class="s">:</span><span class="si">%(minute)02d</span><span class="s">:</span><span class="si">%(second)02d</span><span class="s">.</span><span class="si">%(microsecond)06d</span><span class="s">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>12:05:57.10558</pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal"><span class="pre">storage_format</span></code> and <code class="docutils literal"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">TIME</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">(</span>
    <span class="n">storage_format</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%(hour)02d</span><span class="s">-</span><span class="si">%(minute)02d</span><span class="s">-</span><span class="si">%(second)02d</span><span class="s">-</span><span class="si">%(microsecond)06d</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;(\d+)-(\d+)-(\d+)-(?:-(\d+))?&quot;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.storage_format">¶</a> &#8211; format string which will be applied to the dict
with keys hour, minute, second, and microsecond.</li>
<li><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.regexp">¶</a> &#8211; regular expression which will be applied to incoming result
rows. If the regexp contains named groups, the resulting match dict is
applied to the Python time() constructor as keyword arguments. Otherwise,
if positional groups are used, the time() constructor is called with
positional arguments via <code class="docutils literal"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-sqlalchemy.dialects.sqlite.pysqlite">
<span id="pysqlite"></span><h2>Pysqlite<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.pysqlite" title="Permalink to this headline">¶</a></h2>
<p>Support for the SQLite database via the pysqlite driver.<p>Note that <code class="docutils literal"><span class="pre">pysqlite</span></code> is the same driver as the <code class="docutils literal"><span class="pre">sqlite3</span></code>
module included with the Python distribution.</p>
</p>
<div class="section" id="dialect-sqlite-pysqlite-url">
<h3>DBAPI<a class="headerlink" href="#dialect-sqlite-pysqlite-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for pysqlite is available at:
<a class="reference external" href="http://docs.python.org/library/sqlite3.html">http://docs.python.org/library/sqlite3.html</a></p>
</div>
<div class="section" id="dialect-sqlite-pysqlite-connect">
<h3>Connecting<a class="headerlink" href="#dialect-sqlite-pysqlite-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-python"><div class="highlight"><pre>sqlite+pysqlite:///file_path</pre></div>
</div>
</p>
</div>
<div class="section" id="driver">
<h3>Driver<a class="headerlink" href="#driver" title="Permalink to this headline">¶</a></h3>
<p>When using Python 2.5 and above, the built in <code class="docutils literal"><span class="pre">sqlite3</span></code> driver is
already installed and no additional installation is needed.  Otherwise,
the <code class="docutils literal"><span class="pre">pysqlite2</span></code> driver needs to be present.  This is the same driver as
<code class="docutils literal"><span class="pre">sqlite3</span></code>, just with a different name.</p>
<p>The <code class="docutils literal"><span class="pre">pysqlite2</span></code> driver will be loaded first, and if not found, <code class="docutils literal"><span class="pre">sqlite3</span></code>
is loaded.  This allows an explicitly installed pysqlite driver to take
precedence over the built in one.   As with all dialects, a specific
DBAPI module may be provided to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal"><span class="pre">create_engine()</span></code></a> to control
this explicitly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlite3</span> <span class="kn">import</span> <span class="n">dbapi2</span> <span class="k">as</span> <span class="n">sqlite</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite+pysqlite:///file.db&#39;</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">sqlite</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="connect-strings">
<h3>Connect Strings<a class="headerlink" href="#connect-strings" title="Permalink to this headline">¶</a></h3>
<p>The file specification for the SQLite database is taken as the &#8220;database&#8221;
portion of the URL.  Note that the format of a SQLAlchemy url is:</p>
<div class="highlight-python"><div class="highlight"><pre>driver://user:pass@host/database</pre></div>
</div>
<p>This means that the actual filename to be used starts with the characters to
the <strong>right</strong> of the third slash.   So connecting to a relative filepath
looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># relative path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite:///path/to/database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>An absolute path, which is denoted by starting with a slash, means you
need <strong>four</strong> slashes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># absolute path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite:////path/to/database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>To use a Windows path, regular drive specifications and backslashes can be
used. Double backslashes are probably needed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># absolute path on Windows</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite:///C:</span><span class="se">\\</span><span class="s">path</span><span class="se">\\</span><span class="s">to</span><span class="se">\\</span><span class="s">database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>The sqlite <code class="docutils literal"><span class="pre">:memory:</span></code> identifier is the default if no filepath is
present.  Specify <code class="docutils literal"><span class="pre">sqlite://</span></code> and nothing else:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in-memory database</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite://&#39;</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="compatibility-with-sqlite3-native-date-and-datetime-types">
<h3>Compatibility with sqlite3 &#8220;native&#8221; date and datetime types<a class="headerlink" href="#compatibility-with-sqlite3-native-date-and-datetime-types" title="Permalink to this headline">¶</a></h3>
<p>The pysqlite driver includes the sqlite3.PARSE_DECLTYPES and
sqlite3.PARSE_COLNAMES options, which have the effect of any column
or expression explicitly cast as &#8220;date&#8221; or &#8220;timestamp&#8221; will be converted
to a Python date or datetime object.  The date and datetime types provided
with the pysqlite dialect are not currently compatible with these options,
since they render the ISO date/datetime including microseconds, which
pysqlite&#8217;s driver does not.   Additionally, SQLAlchemy does not at
this time automatically render the &#8220;cast&#8221; syntax required for the
freestanding functions &#8220;current_timestamp&#8221; and &#8220;current_date&#8221; to return
datetime/date types natively.   Unfortunately, pysqlite
does not provide the standard DBAPI types in <code class="docutils literal"><span class="pre">cursor.description</span></code>,
leaving SQLAlchemy with no way to detect these types on the fly
without expensive per-row type checks.</p>
<p>Keeping in mind that pysqlite&#8217;s parsing option is not recommended,
nor should be necessary, for use with SQLAlchemy, usage of PARSE_DECLTYPES
can be forced if one configures &#8220;native_datetime=True&#8221; on create_engine():</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite://&#39;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;detect_types&#39;</span><span class="p">:</span>
        <span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_DECLTYPES</span><span class="o">|</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_COLNAMES</span><span class="p">},</span>
    <span class="n">native_datetime</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span></pre></div>
</div>
<p>With this flag enabled, the DATE and TIMESTAMP types (but note - not the
DATETIME or TIME types...confused yet ?) will not perform any bind parameter
or result processing. Execution of &#8220;func.current_date()&#8221; will return a string.
&#8220;func.current_timestamp()&#8221; is registered as returning a DATETIME type in
SQLAlchemy, so this function still receives SQLAlchemy-level result
processing.</p>
</div>
<div class="section" id="threading-pooling-behavior">
<span id="pysqlite-threading-pooling"></span><h3>Threading/Pooling Behavior<a class="headerlink" href="#threading-pooling-behavior" title="Permalink to this headline">¶</a></h3>
<p>Pysqlite&#8217;s default behavior is to prohibit the usage of a single connection
in more than one thread.   This is originally intended to work with older
versions of SQLite that did not support multithreaded operation under
various circumstances.  In particular, older SQLite versions
did not allow a <code class="docutils literal"><span class="pre">:memory:</span></code> database to be used in multiple threads
under any circumstances.</p>
<p>Pysqlite does include a now-undocumented flag known as
<code class="docutils literal"><span class="pre">check_same_thread</span></code> which will disable this check, however note that
pysqlite connections are still not safe to use in concurrently in multiple
threads.  In particular, any statement execution calls would need to be
externally mutexed, as Pysqlite does not provide for thread-safe propagation
of error messages among other things.   So while even <code class="docutils literal"><span class="pre">:memory:</span></code> databases
can be shared among threads in modern SQLite, Pysqlite doesn&#8217;t provide enough
thread-safety to make this usage worth it.</p>
<p>SQLAlchemy sets up pooling to work with Pysqlite&#8217;s default behavior:</p>
<ul>
<li><p class="first">When a <code class="docutils literal"><span class="pre">:memory:</span></code> SQLite database is specified, the dialect by default
will use <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a>. This pool maintains a single
connection per thread, so that all access to the engine within the current
thread use the same <code class="docutils literal"><span class="pre">:memory:</span></code> database - other threads would access a
different <code class="docutils literal"><span class="pre">:memory:</span></code> database.</p>
</li>
<li><p class="first">When a file-based database is specified, the dialect will use
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a> as the source of connections. This pool closes and
discards connections which are returned to the pool immediately. SQLite
file-based connections have extremely low overhead, so pooling is not
necessary. The scheme also prevents a connection from being used again in
a different thread and works best with SQLite&#8217;s coarse-grained file locking.</p>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 0.7: </span>Default selection of <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a> for SQLite file-based databases.
Previous versions select <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a> by
default for all SQLite databases.</p>
</div>
</li>
</ul>
<div class="section" id="using-a-memory-database-in-multiple-threads">
<h4>Using a Memory Database in Multiple Threads<a class="headerlink" href="#using-a-memory-database-in-multiple-threads" title="Permalink to this headline">¶</a></h4>
<p>To use a <code class="docutils literal"><span class="pre">:memory:</span></code> database in a multithreaded scenario, the same
connection object must be shared among threads, since the database exists
only within the scope of that connection.   The
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal"><span class="pre">StaticPool</span></code></a> implementation will maintain a single connection
globally, and the <code class="docutils literal"><span class="pre">check_same_thread</span></code> flag can be passed to Pysqlite
as <code class="docutils literal"><span class="pre">False</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite://&#39;</span><span class="p">,</span>
                    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;check_same_thread&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">},</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div>
</div>
<p>Note that using a <code class="docutils literal"><span class="pre">:memory:</span></code> database in multiple threads requires a recent
version of SQLite.</p>
</div>
<div class="section" id="using-temporary-tables-with-sqlite">
<h4>Using Temporary Tables with SQLite<a class="headerlink" href="#using-temporary-tables-with-sqlite" title="Permalink to this headline">¶</a></h4>
<p>Due to the way SQLite deals with temporary tables, if you wish to use a
temporary table in a file-based SQLite database across multiple checkouts
from the connection pool, such as when using an ORM <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> where
the temporary table should continue to remain after <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">Session.commit()</span></code></a> or
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a> is called, a pool which maintains a single
connection must be used.   Use <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a> if the scope is
only needed within the current thread, or <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal"><span class="pre">StaticPool</span></code></a> is scope is
needed within multiple threads for this case:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># maintain the same connection per thread</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">SingletonThreadPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite:///mydb.db&#39;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">SingletonThreadPool</span><span class="p">)</span>


<span class="c"># maintain the same connection across all threads</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite:///mydb.db&#39;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div>
</div>
<p>Note that <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a> should be configured for the number
of threads that are to be used; beyond that number, connections will be
closed out in a non deterministic way.</p>
</div>
</div>
<div class="section" id="unicode">
<h3>Unicode<a class="headerlink" href="#unicode" title="Permalink to this headline">¶</a></h3>
<p>The pysqlite driver only returns Python <code class="docutils literal"><span class="pre">unicode</span></code> objects in result sets,
never plain strings, and accommodates <code class="docutils literal"><span class="pre">unicode</span></code> objects within bound
parameter values in all cases.   Regardless of the SQLAlchemy string type in
use, string-based result values will by Python <code class="docutils literal"><span class="pre">unicode</span></code> in Python 2.
The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal"><span class="pre">Unicode</span></code></a> type should still be used to indicate those columns that
require unicode, however, so that non-<code class="docutils literal"><span class="pre">unicode</span></code> values passed inadvertently
will emit a warning.  Pysqlite will emit an error if a non-<code class="docutils literal"><span class="pre">unicode</span></code> string
is passed containing non-ASCII characters.</p>
</div>
<div class="section" id="serializable-isolation-savepoints-transactional-ddl">
<span id="pysqlite-serializable"></span><h3>Serializable isolation / Savepoints / Transactional DDL<a class="headerlink" href="#serializable-isolation-savepoints-transactional-ddl" title="Permalink to this headline">¶</a></h3>
<p>In the section <a class="reference internal" href="#sqlite-concurrency"><span>Database Locking Behavior / Concurrency</span></a>, we refer to the pysqlite
driver&#8217;s assortment of issues that prevent several features of SQLite
from working correctly.  The pysqlite DBAPI driver has several
long-standing bugs which impact the correctness of its transactional
behavior.   In its default mode of operation, SQLite features such as
SERIALIZABLE isolation, transactional DDL, and SAVEPOINT support are
non-functional, and in order to use these features, workarounds must
be taken.</p>
<p>The issue is essentially that the driver attempts to second-guess the user&#8217;s
intent, failing to start transactions and sometimes ending them prematurely, in
an effort to minimize the SQLite databases&#8217;s file locking behavior, even
though SQLite itself uses &#8220;shared&#8221; locks for read-only activities.</p>
<p>SQLAlchemy chooses to not alter this behavior by default, as it is the
long-expected behavior of the pysqlite driver; if and when the pysqlite
driver attempts to repair these issues, that will be more of a driver towards
defaults for SQLAlchemy.</p>
<p>The good news is that with a few events, we can implement transactional
support fully, by disabling pysqlite&#8217;s feature entirely and emitting BEGIN
ourselves. This is achieved using two event listeners:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">event</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&quot;sqlite:///myfile.db&quot;</span><span class="p">)</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_connect</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="c"># disable pysqlite&#39;s emitting of the BEGIN statement entirely.</span>
    <span class="c"># also stops it from emitting COMMIT before any DDL.</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">isolation_level</span> <span class="o">=</span> <span class="bp">None</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="c"># emit our own BEGIN</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;BEGIN&quot;</span><span class="p">)</span></pre></div>
</div>
<p>Above, we intercept a new pysqlite connection and disable any transactional
integration.   Then, at the point at which SQLAlchemy knows that transaction
scope is to begin, we emit <code class="docutils literal"><span class="pre">&quot;BEGIN&quot;</span></code> ourselves.</p>
<p>When we take control of <code class="docutils literal"><span class="pre">&quot;BEGIN&quot;</span></code>, we can also control directly SQLite&#8217;s
locking modes, introduced at <a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>,
by adding the desired locking mode to our <code class="docutils literal"><span class="pre">&quot;BEGIN&quot;</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;BEGIN EXCLUSIVE&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p><a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a> - on the SQLite site</p>
<p><a class="reference external" href="http://bugs.python.org/issue9924">sqlite3 SELECT does not BEGIN a transaction</a> - on the Python bug tracker</p>
<p class="last"><a class="reference external" href="http://bugs.python.org/issue10740">sqlite3 module breaks transactions and potentially corrupts data</a> - on the Python bug tracker</p>
</div>
</div>
</div>
<div class="section" id="module-sqlalchemy.dialects.sqlite.pysqlcipher">
<span id="pysqlcipher"></span><h2>Pysqlcipher<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher" title="Permalink to this headline">¶</a></h2>
<p>Support for the SQLite database via the pysqlcipher driver.<p><code class="docutils literal"><span class="pre">pysqlcipher</span></code> is a fork of the standard <code class="docutils literal"><span class="pre">pysqlite</span></code> driver to make
use of the <a class="reference external" href="https://www.zetetic.net/sqlcipher">SQLCipher</a> backend.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.9.9.</span></p>
</div>
</p>
<div class="section" id="dialect-sqlite-pysqlcipher-url">
<h3>DBAPI<a class="headerlink" href="#dialect-sqlite-pysqlcipher-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for pysqlcipher is available at:
<a class="reference external" href="https://pypi.python.org/pypi/pysqlcipher">https://pypi.python.org/pypi/pysqlcipher</a></p>
</div>
<div class="section" id="dialect-sqlite-pysqlcipher-connect">
<h3>Connecting<a class="headerlink" href="#dialect-sqlite-pysqlcipher-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-python"><div class="highlight"><pre>sqlite+pysqlcipher://:passphrase/file_path[?kdf_iter=&lt;iter&gt;]</pre></div>
</div>
</p>
</div>
<div class="section" id="id3">
<h3>Driver<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The driver here is the <a class="reference external" href="https://pypi.python.org/pypi/pysqlcipher">pysqlcipher</a>
driver, which makes use of the SQLCipher engine.  This system essentially
introduces new PRAGMA commands to SQLite which allows the setting of a
passphrase and other encryption parameters, allowing the database
file to be encrypted.</p>
</div>
<div class="section" id="id5">
<h3>Connect Strings<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The format of the connect string is in every way the same as that
of the <a class="reference internal" href="#module-sqlalchemy.dialects.sqlite.pysqlite" title="sqlalchemy.dialects.sqlite.pysqlite"><code class="xref py py-mod docutils literal"><span class="pre">pysqlite</span></code></a> driver, except that the
&#8220;password&#8221; field is now accepted, which should contain a passphrase:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite+pysqlcipher://:testing@/foo.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>For an absolute file path, two leading slashes should be used for the
database name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite+pysqlcipher://:testing@//path/to/foo.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>A selection of additional encryption-related pragmas supported by SQLCipher
as documented at <a class="reference external" href="https://www.zetetic.net/sqlcipher/sqlcipher-api/">https://www.zetetic.net/sqlcipher/sqlcipher-api/</a> can be passed
in the query string, and will result in that PRAGMA being called for each
new connection.  Currently, <code class="docutils literal"><span class="pre">cipher</span></code>, <code class="docutils literal"><span class="pre">kdf_iter</span></code>
<code class="docutils literal"><span class="pre">cipher_page_size</span></code> and <code class="docutils literal"><span class="pre">cipher_use_hmac</span></code> are supported:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite+pysqlcipher://:testing@/foo.db?cipher=aes-256-cfb&amp;kdf_iter=64000&#39;</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="pooling-behavior">
<h3>Pooling Behavior<a class="headerlink" href="#pooling-behavior" title="Permalink to this headline">¶</a></h3>
<p>The driver makes a change to the default pool behavior of pysqlite
as described in <a class="reference internal" href="#pysqlite-threading-pooling"><span>Threading/Pooling Behavior</span></a>.   The pysqlcipher driver
has been observed to be significantly slower on connection than the
pysqlite driver, most likely due to the encryption overhead, so the
dialect here defaults to using the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a>
implementation,
instead of the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a> pool used by pysqlite.  As always, the pool
implementation is entirely configurable using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.poolclass" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.poolclass</span></code></a> parameter; the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal"><span class="pre">StaticPool</span></code></a> may
be more feasible for single-threaded use, or <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a> may be used
to prevent unencrypted connections from being held open for long periods of
time, at the expense of slower startup time for new connections.</p>
</div>
</div>
</div>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links">
        Previous:
        <a href="postgresql.html" title="previous chapter">PostgreSQL</a>
        Next:
        <a href="sybase.html" title="next chapter">Sybase</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2015, the SQLAlchemy authors and contributors.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>
</div>

</div>


        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.0.8',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


